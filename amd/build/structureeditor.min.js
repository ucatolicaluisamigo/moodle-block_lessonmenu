define("block_lessonmenu/structureeditor",["exports","jquery","core/sortable_list","core/log","core/modal_factory","core/str"],(function(_exports,_jquery,_sortable_list,_log,_modal_factory,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module structureeditor
   *
   * @module     block_lessonmenu/structureeditor
   * @copyright  2025 David Herney @ BambuCo
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_sortable_list=_interopRequireDefault(_sortable_list),_log=_interopRequireDefault(_log),_modal_factory=_interopRequireDefault(_modal_factory);var strings=[{key:"changecontenttype",component:"block_lessonmenu"}],s=[];_exports.init=async()=>{const $editorContainer=(0,_jquery.default)("#lessonmenu-editor");if(0===$editorContainer.length)return;var changeTypeModal;await(strings.forEach((one=>{s[one.key]=one.key})),new Promise((resolve=>{(0,_str.get_strings)(strings).then((function(results){var pos=0;return strings.forEach((one=>{s[one.key]=results[pos],pos++})),resolve(!0),!0})).fail((function(e){return _log.default.debug("Error loading strings"),_log.default.debug(e),!1}))}))).catch((()=>null));var $currentItem=null;new _sortable_list.default("#lessonmenu-editor",{targetListSelector:null,moveHandlerSelector:"[data-drag-type=move]",isHorizontal:!1,autoScroll:!0}).getElementType=element=>_jquery.default.Deferred().resolve(element.attr("data-type")),(0,_jquery.default)('#lessonmenu-edit-structure-actions [data-action="adddefaultsections"]').on("click",(event=>{event.preventDefault();const selectedvalue=(0,_jquery.default)("#lessonmenu-add-defaultsections select").val(),values=JSON.parse(selectedvalue);if(values&&values.length>0){values.forEach((title=>{const $newitem=newSection(title);null!==$newitem&&$editorContainer.append($newitem)}));const $inputs=$editorContainer.find('input[type="text"]');$inputs.length&&$inputs.last()[0].focus()}else _log.default.debug("No sections selected to add.")})),(0,_jquery.default)('#lessonmenu-edit-structure-actions [data-action="addsection"]').on("click",(event=>{event.preventDefault();const $newitem=newSection("");null!==$newitem&&($editorContainer.append($newitem),$newitem.find('input[type="text"]')[0].focus())})),(0,_jquery.default)('#lessonmenu-edit-structure-actions [data-action="deletesection"]').on("click",(event=>{event.preventDefault(),deletesection(event)})),$editorContainer.find(".item-icon").on("click",(event=>{event.preventDefault();const $item=(0,_jquery.default)(event.currentTarget).closest('[data-type="page"]');$item.length&&(changeTypeModal.show(),$currentItem=$item)}));const $iconModal=(0,_jquery.default)("#lessonmenu-change-icon-modal");_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,body:$iconModal.html(),title:s.changecontenttype}).then((function(modal){return changeTypeModal=modal,modal.getRoot().find("#lessonmenu-change-icon-select > li").on("click",(event=>{event.preventDefault();const $selected=(0,_jquery.default)(event.currentTarget),code=$selected.attr("value");if($currentItem&&code){const $iconspan=$currentItem.find(".item-icon");$iconspan.length&&($iconspan.html($selected.find("> span").html()),$iconspan.attr("title",$selected.find("> span").attr("title")||"")),$currentItem.attr("data-contenttype",code)}$currentItem=null,modal.hide()})),modal})).fail((function(){_log.default.error("Error creating change content type modal")}))};const deletesection=event=>{event.preventDefault();const $section=(0,_jquery.default)(event.currentTarget).closest('[data-type="section"]');$section.length&&$section.remove()},newSection=title=>{const $tplsection=(0,_jquery.default)('[data-tpl="section"]');if(0===$tplsection.length)return _log.default.debug("Template for section not found."),null;let contentsection=$tplsection.html();contentsection=contentsection.replace(/\[title\]/g,title);const $newitem=(0,_jquery.default)(contentsection);return $newitem.find('[data-action="deletesection"]').on("click",(event=>{deletesection(event)})),$newitem}}));

//# sourceMappingURL=structureeditor.min.js.map